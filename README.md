# mbroker
**mbroker** — это простой in-memory брокер сообщений, реализованный на языке Rust в рамках тестового задания. Проект поддерживает создание топиков, подписку, публикацию сообщений, подтверждение обработки и отписку через HTTP API.

**Особенности**

* Лёгкая архитектура с использованием асинхронных каналов (tokio::sync::broadcast).

* Базовая поддержка ретеншена сообщений и управления подписчиками.

* Логирование действий через RUST_LOG.

* API, совместимый с JSON.

## Запуск проекта
1. Соберите и запустите брокер: 
```
RUST_LOG=info cargo run
```

2. Создайте новый топик: 
```
curl -X POST -H "Content-Type: application/json" -d '{"compaction_enabled": false, "retention_duration_secs": 300}' http://127.0.0.1:1337/topics/my_topic
```

3. Подпишитесь на топик:
```
curl -i http://127.0.0.1:1337/topics/my_topic/subscribe
```

4. Отправьте сообщение в топик:
```
curl -X POST -H "Content-Type: application/json" -d '{"key": null, "data": "Hello, world!"}' http://127.0.0.1:1337/topics/my_topic/publish
```

5. Подтвердите получение сообщения:
```
curl -X POST -H "Content-Type: application/json" -d '{"message_id": "<message_id>"}' --cookie "subscriber_id=<subscriber_id>" http://127.0.0.1:1337/topics/my_topic/commit
```

6. Отпишитесь от топика:
```
curl -X POST --cookie "subscriber_id=<subscriber_id>" http://127.0.0.1:1337/topics/my_topic/unsubscribe
```

### Тестовое задание: in-memory брокер сообщений

**Задание:** разработать и реализовать in-memory брокер сообщений на языке Rust. Брокер должен обеспечивать распределение потоков сообщений по топикам, при этом каждое сообщение может иметь опциональный ключ. Формат сообщения и ключа, а также протокол взаимодействия с брокером выбирает кандидат (например, байтовый массив или JSON для данных; TCP или HTTP \+ SSE для взаимодействия).

### Требуемые функции

Брокер должен поддерживать следующие операции:

1. **Создание топика:** добавление нового топика для сообщений.  
2. **Подписка на сообщения:** регистрация клиента на получение сообщений из указанного топика.  
3. **Отписка от сообщений:** прекращение отправки сообщений клиенту из указанного топика.  
4. **Добавление сообщения:** отправка сообщения в конкретный топик для дальнейшей доставки подписчикам.

### Дополнительные функции (будет плюсом)

Реализация следующих функций будет преимуществом:

* **Retention для топиков:** поддержка параметра времени хранения сообщений в топике, по истечении которого сообщение удаляется и становится недоступным для подписчиков.  
* **Compaction для топиков:** поддержка механизма компакции сообщений. При этом в топике сохраняется только последнее сообщение с определённым ключом, все предыдущие сообщения с таким же ключом удаляются. См. [документацию Kafka](https://kafka.apache.org/documentation/#compaction) для справки.  
* **Commit-механизм:** сообщение считается доставленным, только если клиент явно сообщил об этом брокеру. До подтверждения доставки сообщение должно оставаться доступным для повторной отправки.

**Требования к реализации:**

* Язык: Rust.  
* Использование библиотек/фреймворков остаётся на усмотрение кандидата.

